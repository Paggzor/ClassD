Version 4
SHEET 1 2372 1232
WIRE -2032 -480 -2176 -480
WIRE -2912 -416 -2912 -464
WIRE -2640 -400 -2784 -400
WIRE -2704 -352 -2704 -448
WIRE -2784 -336 -2784 -400
WIRE -2736 -336 -2784 -336
WIRE 2000 -336 2000 -352
WIRE -2640 -320 -2640 -400
WIRE -2640 -320 -2672 -320
WIRE -2560 -320 -2640 -320
WIRE -2496 -320 -2560 -320
WIRE -2368 -320 -2368 -480
WIRE -2368 -320 -2416 -320
WIRE -2336 -320 -2368 -320
WIRE -2208 -320 -2272 -320
WIRE -2160 -320 -2208 -320
WIRE -2032 -320 -2032 -480
WIRE -2032 -320 -2080 -320
WIRE -3120 -304 -3248 -304
WIRE -2912 -304 -2912 -336
WIRE -2736 -304 -2912 -304
WIRE 1360 -304 1344 -304
WIRE 1440 -304 1360 -304
WIRE -2912 -288 -2912 -304
WIRE -3248 -272 -3248 -304
WIRE 1600 -272 1600 -320
WIRE 1728 -272 1728 -320
WIRE -3120 -256 -3120 -304
WIRE 1440 -256 1440 -304
WIRE -2704 -240 -2704 -288
WIRE 336 -240 256 -240
WIRE 2000 -240 2000 -256
WIRE 2000 -240 1904 -240
WIRE 2144 -240 2000 -240
WIRE 336 -224 336 -240
WIRE 1904 -224 1904 -240
WIRE 2000 -224 2000 -240
WIRE -2368 -208 -2368 -320
WIRE -2304 -208 -2368 -208
WIRE -2208 -208 -2208 -320
WIRE -2208 -208 -2224 -208
WIRE -2288 -160 -2320 -160
WIRE -2208 -160 -2240 -160
WIRE 1600 -144 1600 -192
WIRE 1728 -144 1728 -192
WIRE 1088 -128 560 -128
WIRE 1376 -128 1088 -128
WIRE 1440 -128 1440 -176
WIRE 1440 -128 1376 -128
WIRE 1904 -128 1904 -160
WIRE 2000 -128 2000 -144
WIRE 2000 -128 1904 -128
WIRE 2048 -128 2000 -128
WIRE 1600 -112 1600 -144
WIRE 1728 -112 1728 -144
WIRE 1904 -112 1904 -128
WIRE 2000 -112 2000 -128
WIRE -2320 -96 -2320 -160
WIRE -2304 -96 -2320 -96
WIRE -2208 -96 -2208 -160
WIRE -2208 -96 -2224 -96
WIRE 560 -96 560 -128
WIRE -2320 -80 -2320 -96
WIRE 1440 -80 1440 -128
WIRE 1088 -64 1088 -128
WIRE 256 -32 256 -240
WIRE 256 -32 240 -32
WIRE 1904 -16 1904 -48
WIRE 2000 -16 2000 -32
WIRE 2000 -16 1904 -16
WIRE 2144 -16 2000 -16
WIRE 384 0 240 0
WIRE 480 0 384 0
WIRE 2000 0 2000 -16
WIRE -1408 16 -1520 16
WIRE -1200 16 -1328 16
WIRE 1600 16 1600 -32
WIRE 1728 16 1728 -32
WIRE 256 32 240 32
WIRE -2368 48 -2368 -208
WIRE 256 48 256 32
WIRE 336 48 336 -144
WIRE 336 48 256 48
WIRE 480 48 336 48
WIRE 560 48 560 32
WIRE 560 48 480 48
WIRE 672 48 560 48
WIRE 688 48 672 48
WIRE 784 48 768 48
WIRE 800 48 784 48
WIRE 896 48 880 48
WIRE 992 48 896 48
WIRE 1040 48 992 48
WIRE 1088 48 1088 0
WIRE 1088 48 1040 48
WIRE 1104 48 1088 48
WIRE 1152 48 1104 48
WIRE 1280 48 1216 48
WIRE 1440 48 1440 0
WIRE 1440 48 1360 48
WIRE 1504 48 1440 48
WIRE 256 64 256 48
WIRE 256 64 240 64
WIRE 1504 64 1504 48
WIRE 992 80 992 48
WIRE -1744 96 -1952 96
WIRE 256 96 256 64
WIRE 256 96 240 96
WIRE 2000 96 2000 80
WIRE -2256 112 -2256 48
WIRE -2224 112 -2256 112
WIRE -1328 112 -1328 96
WIRE -1296 112 -1328 112
WIRE 672 112 672 48
WIRE 752 112 672 112
WIRE 1104 112 1104 48
WIRE -1872 128 -1872 64
WIRE -1840 128 -1840 80
WIRE -1328 128 -1328 112
WIRE -1296 128 -1296 112
WIRE 256 128 256 96
WIRE 256 128 240 128
WIRE -3120 144 -3296 144
WIRE -2256 144 -2256 112
WIRE -2224 144 -2224 112
WIRE -144 144 -624 144
WIRE 416 144 288 144
WIRE 672 144 672 112
WIRE -3248 160 -3248 96
WIRE -3216 160 -3216 112
WIRE -2368 160 -2368 48
WIRE -2304 160 -2368 160
WIRE -2288 160 -2304 160
WIRE -2256 160 -2256 144
WIRE -1952 160 -1952 96
WIRE -1888 160 -1952 160
WIRE -1344 160 -1488 160
WIRE 256 160 256 128
WIRE 256 160 240 160
WIRE 560 160 560 48
WIRE -2304 176 -2304 160
WIRE -2272 176 -2304 176
WIRE -2176 176 -2192 176
WIRE -1792 176 -1808 176
WIRE -1200 176 -1200 16
WIRE -1200 176 -1264 176
WIRE -800 176 -1200 176
WIRE -144 176 -800 176
WIRE -3296 192 -3296 144
WIRE -3264 192 -3296 192
WIRE -2176 192 -2176 176
WIRE -2176 192 -2192 192
WIRE -2032 192 -2032 -320
WIRE -2032 192 -2176 192
WIRE -2016 192 -2032 192
WIRE -1888 192 -2016 192
WIRE -1792 192 -1792 176
WIRE -1744 192 -1744 96
WIRE -1744 192 -1792 192
WIRE -1584 192 -1744 192
WIRE -1520 192 -1520 16
WIRE -1520 192 -1584 192
WIRE -1344 192 -1520 192
WIRE 752 192 752 112
WIRE -3120 208 -3120 144
WIRE -3120 208 -3184 208
WIRE -2752 208 -3120 208
WIRE -2304 208 -2752 208
WIRE -2272 208 -2304 208
WIRE 992 208 992 144
WIRE 1104 208 1104 176
WIRE 1104 208 992 208
WIRE -3936 224 -4064 224
WIRE -3840 224 -3936 224
WIRE -3520 224 -3840 224
WIRE -3344 224 -3456 224
WIRE -3264 224 -3344 224
WIRE -2304 224 -2304 208
WIRE -2304 224 -2320 224
WIRE -2288 224 -2304 224
WIRE 288 224 288 144
WIRE 288 224 240 224
WIRE 672 224 672 208
WIRE -2256 240 -2256 224
WIRE -1840 256 -1840 224
WIRE -1328 256 -1328 224
WIRE -624 256 -624 144
WIRE 352 256 240 256
WIRE 480 256 352 256
WIRE -3936 272 -3936 224
WIRE -1296 272 -1296 224
WIRE -3216 288 -3216 256
WIRE 272 288 240 288
WIRE -3344 304 -3344 224
WIRE -2256 304 -2256 240
WIRE -1872 304 -1872 224
WIRE -2320 320 -2320 224
WIRE 272 320 272 288
WIRE 272 320 240 320
WIRE -3248 336 -3248 256
WIRE 272 336 272 320
WIRE 416 336 416 224
WIRE 416 336 272 336
WIRE 480 336 480 320
WIRE 480 336 416 336
WIRE 560 336 560 288
WIRE 560 336 480 336
WIRE 672 336 672 304
WIRE 672 336 560 336
WIRE 752 336 752 272
WIRE 752 336 672 336
WIRE 272 352 272 336
WIRE 272 352 240 352
WIRE -3936 384 -3936 352
WIRE 560 400 560 336
WIRE -3344 432 -3344 384
WIRE 128 528 16 528
WIRE 240 528 192 528
WIRE -2912 608 -2912 -208
WIRE 16 624 16 528
WIRE 128 624 16 624
WIRE 240 624 240 528
WIRE 240 624 208 624
WIRE 784 624 784 48
WIRE -4064 656 -4064 432
WIRE 896 688 896 48
WIRE 672 752 672 592
WIRE -2912 768 -2912 688
WIRE 784 768 784 624
WIRE 784 768 720 768
WIRE -2320 784 -2320 400
WIRE 240 800 240 624
WIRE 240 800 192 800
WIRE 592 800 512 800
WIRE -1488 832 -1488 160
WIRE -160 832 -1488 832
WIRE -48 832 -48 816
WIRE -48 832 -160 832
WIRE 16 832 16 624
WIRE 16 832 -48 832
WIRE 48 832 16 832
WIRE 896 832 896 688
WIRE 896 832 720 832
WIRE 256 864 192 864
WIRE 256 928 256 864
WIRE 672 960 672 848
WIRE -48 976 -48 832
WIRE 512 976 512 800
WIRE 512 976 -48 976
WIRE 512 1008 512 976
WIRE 512 1152 512 1088
FLAG 1504 64 0
FLAG 992 208 0
FLAG 560 400 0
FLAG 1728 -320 5V
FLAG -1328 96 5V
FLAG -1296 272 0
FLAG 512 1152 0
FLAG -2256 48 5V
FLAG 1040 48 Vo
FLAG -2912 -464 Vo
FLAG -2320 784 0
FLAG 480 48 Sw
FLAG -2016 192 EA
FLAG -3840 224 Vin
FLAG -160 832 sens
FLAG 384 0 Tg
FLAG 352 256 Bg
FLAG 784 624 Curr+
FLAG 896 688 Curr-
FLAG 1376 -128 Vcc
FLAG -2912 768 0
FLAG -4064 656 0
FLAG -1584 192 Vp
FLAG 672 592 Vcc+5V
FLAG -3248 -192 0
FLAG -800 176 PWM
FLAG -2560 -320 Vfb
FLAG -3936 384 0
FLAG -2704 -448 5V
FLAG 1728 -144 0
FLAG 1728 16 -5V
FLAG -3344 432 0
FLAG 2000 96 -5V
FLAG 2000 -352 5V
FLAG 2048 -128 0
FLAG 2144 -16 Clamp-
FLAG 2144 -240 Clamp+
FLAG -3216 112 Clamp+
FLAG -3216 288 Clamp-
FLAG -3248 96 5V
FLAG -3248 336 -5V
FLAG -1840 80 Clamp+
FLAG -1840 256 Clamp-
FLAG -1872 64 5V
FLAG -1872 304 -5V
FLAG -1328 256 -5V
FLAG 672 960 -5V
FLAG -2256 304 -5V
FLAG -2704 -240 -5V
FLAG 1360 -304 Vcc+5V
FLAG -2752 208 vin_clamp
FLAG -2368 48 vin_clamp_neg
FLAG -624 336 0
FLAG -2320 -80 0
FLAG 256 928 0
FLAG 1600 -320 2.5V
FLAG 1600 -144 0
FLAG 1600 16 -2.5V
FLAG 160 752 2.5V
FLAG 160 912 -2.5V
DATAFLAG 544 800 ""
DATAFLAG -3792 224 ""
DATAFLAG 928 48 ""
SYMBOL ind 672 64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 330nH
SYMATTR SpiceLine2 IC=0
SYMBOL voltage 1440 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 40
SYMBOL cap 976 80 R0
WINDOW 40 24 84 Left 2
SYMATTR InstName C1
SYMATTR Value 470nF
SYMBOL res 896 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -68 36 VTop 2
SYMATTR InstName R1
SYMATTR Value {100mV/Imax}
SYMBOL voltage 1728 -288 R0
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL res 1376 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1.3
SYMBOL res -2928 -432 R0
SYMATTR InstName R2
SYMATTR Value {1k*(Gain-1)}
SYMBOL res -2176 -304 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value {1k*EAgain}
SYMBOL voltage -3936 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value SINE(0 1 300k)
SYMBOL res -2304 416 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL res -2928 -304 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL voltage -4064 336 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value PULSE(0 1 21u 1n 1n 10u 22u)
SYMBOL current-amp 672 816 M0
SYMATTR InstName X1
SYMBOL res 496 992 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL EPCGaN 480 0 R0
SYMATTR InstName U1
SYMATTR Value EPC2214
SYMBOL EPCGaN 480 256 R0
SYMATTR InstName U2
SYMATTR Value EPC2214
SYMBOL cap 656 144 R0
SYMATTR InstName C2
SYMATTR Value 10p
SYMBOL res 656 208 R0
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL res -1312 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rhyst}
SYMBOL Comparators\\LT1715 -1312 176 R0
SYMATTR InstName U4
SYMBOL voltage -2912 592 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {-20 / (Gain-1)}
SYMBOL cap -3456 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL voltage -3248 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value SINE(20V 0.1 600k)
SYMBOL cap 1216 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL OpAmps\\LT1803 -2704 -320 R0
SYMATTR InstName U5
SYMBOL res -2400 -336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL voltage 1728 -128 R0
SYMATTR InstName V13
SYMATTR Value 5V
SYMBOL res -3360 288 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 1984 -352 R0
SYMATTR InstName R13
SYMATTR Value {(5-EAClamp)/EAClamp * 1k}
SYMBOL res 1984 -240 R0
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 1984 -128 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL res 1984 -16 R0
SYMATTR InstName R18
SYMATTR Value {(5-EAClamp)/EAClamp * 1k}
SYMBOL cap 1888 -224 R0
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL cap 1888 -112 R0
SYMATTR InstName C7
SYMATTR Value 1n
SYMBOL AD8036 -1856 176 R0
SYMATTR InstName U7
SYMBOL AD8036 -3232 208 R0
SYMATTR InstName U8
SYMBOL voltage 1440 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL ADA4817 -2240 192 R0
SYMATTR InstName U3
SYMBOL LMG1210-simple2 48 0 R0
SYMATTR InstName X2
SYMBOL voltage 336 -240 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 5
SYMBOL voltage 416 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL voltage -624 240 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value PULSE(0 5 2n 10n 10n 1000 1000)
SYMBOL res -2160 -496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {30k*EAgain}
SYMBOL cap -2272 -336 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -68 -74 VTop 2
SYMATTR InstName C8
SYMATTR Value {1 / (6 * Pole * 1k*EAgain) }
SYMBOL diode 1104 0 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 1120 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL sw -2320 -208 R270
WINDOW 3 -115 142 Left 2
SYMATTR Value MySwitch
SYMATTR InstName S1
SYMBOL voltage -2208 -96 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 40 21 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value {1-two_pole_enable}
SYMBOL res 224 608 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL cap 192 512 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1p
SYMBOL voltage 1600 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 2.5
SYMBOL voltage 1600 -128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V14
SYMATTR Value 2.5
SYMBOL res 736 176 R0
SYMATTR InstName R9
SYMATTR Value 100k
TEXT -960 632 Left 2 !.tran 0 30u 0 0.1n
TEXT -968 656 Left 2 !.lib opamp.sub
TEXT -968 696 Left 2 !.param EAgain=4.2
TEXT -1448 -88 Left 2 ;gm_comp = 1/rm = 10 A/V
TEXT -1440 -40 Left 2 ;gm_tot = A-fb * gm_comp
TEXT 1112 776 Left 2 ;Iout 1mA (gm*0.1) @ Vsens-max 100mV -> \nR7=1k.  Imax =>1V:  \n \nR1 = Vsens-max / Imax = 0.1V / 10A = 10mOhm
TEXT -968 720 Left 2 !.param EAclamp=1
TEXT -968 512 Left 2 !#.step param two_pole_enable list  0 1
TEXT -968 744 Left 2 !.param Imax=20
TEXT -968 768 Left 2 !.param Rhyst=1MEG
TEXT -968 824 Left 2 !.param Gain=15
TEXT -952 576 Left 2 !.IC I(L1)=0
TEXT -960 888 Left 2 !.param Pole=700k
TEXT -960 936 Left 2 !.param two_pole_enable=0
TEXT -2360 -616 Left 2 !.model MySwitch SW(Ron=1m Roff=10Meg Vt=0.5 Vh=0)
TEXT -968 536 Left 2 !#.step param Pole list 50k 300k 1Meg 3Meg
TEXT -968 488 Left 2 !#.step param EAGain list 3 6
