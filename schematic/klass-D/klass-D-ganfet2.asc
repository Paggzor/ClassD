Version 4
SHEET 1 1960 1232
WIRE -3376 -304 -3504 -304
WIRE 1440 -288 1392 -288
WIRE -3504 -272 -3504 -304
WIRE -3376 -256 -3376 -304
WIRE -3168 -256 -3168 -304
WIRE 1440 -256 1440 -288
WIRE -2896 -240 -3040 -240
WIRE -2960 -192 -2960 -288
WIRE -3040 -176 -3040 -240
WIRE -2992 -176 -3040 -176
WIRE -2896 -160 -2896 -240
WIRE -2896 -160 -2928 -160
WIRE -2816 -160 -2896 -160
WIRE -2752 -160 -2816 -160
WIRE -2624 -160 -2672 -160
WIRE -2464 -160 -2624 -160
WIRE -2320 -160 -2384 -160
WIRE -3168 -144 -3168 -176
WIRE -2992 -144 -3168 -144
WIRE -1840 -144 -1936 -144
WIRE -3168 -128 -3168 -144
WIRE 976 -128 560 -128
WIRE 1376 -128 1056 -128
WIRE 1440 -128 1440 -176
WIRE 1440 -128 1376 -128
WIRE 560 -96 560 -128
WIRE -2960 -80 -2960 -128
WIRE 1440 -80 1440 -128
WIRE -1840 -64 -1840 -144
WIRE -2624 -48 -2624 -160
WIRE -2496 -48 -2624 -48
WIRE -2320 -48 -2320 -160
WIRE -2320 -48 -2432 -48
WIRE -1936 0 -1936 -144
WIRE 384 0 240 0
WIRE 480 0 384 0
WIRE -1408 16 -1520 16
WIRE -1200 16 -1328 16
WIRE 256 32 240 32
WIRE 256 48 256 32
WIRE 480 48 256 48
WIRE 560 48 560 32
WIRE 560 48 480 48
WIRE 672 48 560 48
WIRE 688 48 672 48
WIRE 784 48 768 48
WIRE 800 48 784 48
WIRE 896 48 880 48
WIRE 992 48 896 48
WIRE 1040 48 992 48
WIRE 1120 48 1040 48
WIRE 1248 48 1184 48
WIRE 1440 48 1440 0
WIRE 1440 48 1328 48
WIRE 1504 48 1440 48
WIRE 256 64 256 48
WIRE 256 64 240 64
WIRE 1504 64 1504 48
WIRE 992 80 992 48
WIRE 256 96 256 64
WIRE 256 96 240 96
WIRE -1328 112 -1328 96
WIRE -1296 112 -1328 112
WIRE -1328 128 -1328 112
WIRE -1296 128 -1296 112
WIRE 256 128 256 96
WIRE 256 128 240 128
WIRE 1440 128 1440 48
WIRE 1904 128 1904 80
WIRE 672 144 672 48
WIRE -2624 160 -2624 -48
WIRE -2560 160 -2624 160
WIRE -2544 160 -2560 160
WIRE -2512 160 -2512 48
WIRE -1344 160 -1488 160
WIRE 256 160 256 128
WIRE 256 160 240 160
WIRE 560 160 560 48
WIRE -2560 176 -2560 160
WIRE -2544 176 -2560 176
WIRE -1200 176 -1200 16
WIRE -1200 176 -1264 176
WIRE -800 176 -1200 176
WIRE -144 176 -800 176
WIRE -2320 192 -2320 -48
WIRE -2320 192 -2480 192
WIRE -2272 192 -2320 192
WIRE -2144 192 -2272 192
WIRE -1936 192 -1936 64
WIRE -1936 192 -2064 192
WIRE -1872 192 -1936 192
WIRE -1744 192 -1872 192
WIRE -1584 192 -1664 192
WIRE -1520 192 -1520 16
WIRE -1520 192 -1584 192
WIRE -1344 192 -1520 192
WIRE -2544 208 -2560 208
WIRE 992 208 992 144
WIRE -3792 224 -3888 224
WIRE -3504 224 -3504 144
WIRE -3504 224 -3792 224
WIRE -3472 224 -3504 224
WIRE -3408 224 -3408 144
WIRE -2576 224 -3408 224
WIRE -2560 224 -2560 208
WIRE -2560 224 -2576 224
WIRE -2544 224 -2560 224
WIRE 672 224 672 208
WIRE 1904 240 1904 208
WIRE 352 256 240 256
WIRE 480 256 352 256
WIRE -3888 272 -3888 224
WIRE 272 288 240 288
WIRE 1440 288 1440 208
WIRE -2512 304 -2512 224
WIRE -2464 304 -2464 272
WIRE -2576 320 -2576 224
WIRE -1936 320 -1936 192
WIRE -1328 320 -1328 224
WIRE -1296 320 -1296 224
WIRE -1296 320 -1328 320
WIRE 272 320 272 288
WIRE 272 320 240 320
WIRE -1328 336 -1328 320
WIRE 272 336 272 320
WIRE 480 336 480 320
WIRE 480 336 272 336
WIRE 560 336 560 288
WIRE 560 336 480 336
WIRE 672 336 672 304
WIRE 672 336 560 336
WIRE 272 352 272 336
WIRE 272 352 240 352
WIRE -3888 384 -3888 352
WIRE 560 400 560 336
WIRE -1936 432 -1936 384
WIRE -3168 608 -3168 -48
WIRE -1936 608 -1936 512
WIRE -2576 624 -2576 400
WIRE 784 688 784 48
WIRE 896 688 896 48
WIRE 672 752 672 592
WIRE -3888 768 -3888 544
WIRE -3168 768 -3168 688
WIRE 784 768 784 688
WIRE 784 768 720 768
WIRE -2576 784 -2576 704
WIRE -1488 800 -1488 160
WIRE 368 800 -1488 800
WIRE 512 800 368 800
WIRE 592 800 512 800
WIRE 896 832 896 688
WIRE 896 832 720 832
WIRE 672 960 672 848
WIRE 512 1024 512 880
WIRE 512 1152 512 1104
FLAG 1504 64 0
FLAG 992 208 0
FLAG 560 400 0
FLAG 1904 240 0
FLAG 1904 80 5V
FLAG -1328 96 5V
FLAG -1328 336 0
FLAG 512 1152 0
FLAG -2512 304 0
FLAG -2464 304 0
FLAG -2512 48 5V
FLAG 1040 48 Vo
FLAG -3168 -304 Vo
FLAG -2576 784 0
FLAG 480 48 Sw
FLAG -2272 192 EA
FLAG -3792 224 Vin
FLAG 368 800 sens
FLAG 384 0 Tg
FLAG 352 256 Bg
FLAG 784 688 Curr+
FLAG 896 688 Curr-
FLAG 1376 -128 Vcc
FLAG -1936 608 0
FLAG -3168 768 0
FLAG -3888 768 0
FLAG -1840 16 0
FLAG -1584 192 Vp
FLAG -1872 192 Ea_Clip
FLAG 1440 288 -5V
FLAG 1392 -288 Vcc+5
FLAG 672 592 Vcc
FLAG 672 960 0
FLAG -3504 -192 0
FLAG -800 176 PWM
FLAG -2816 -160 Vfb
FLAG -3888 384 0
FLAG -2960 -288 5V
FLAG -2960 -80 0
DATAFLAG 544 800 ""
DATAFLAG -3744 224 ""
SYMBOL ind 672 64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 800n
SYMBOL voltage 1440 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 40
SYMBOL cap 976 80 R0
SYMATTR InstName C1
SYMATTR Value 300n
SYMBOL res 896 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -68 36 VTop 2
SYMATTR InstName R1
SYMATTR Value {100mV/Imax}
SYMBOL voltage 1904 112 R0
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL voltage 512 1008 R0
SYMATTR InstName V4
SYMATTR Value 2.5V
SYMBOL res 1344 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 3
SYMBOL res -3184 -272 R0
SYMATTR InstName R2
SYMATTR Value 19k
SYMBOL res -2480 -144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value {1k*EAgain}
SYMBOL voltage -3888 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value SINE(2.5 0.7 10k)
SYMBOL res -2560 416 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL res -3184 -144 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL voltage -3888 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value PWL(10u 0 11u -4v 12u 4v 13u -4 14u 4 15u 0)
SYMBOL voltage -2576 608 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 2.5V
SYMBOL current-amp 672 816 M0
SYMATTR InstName X1
SYMBOL res 496 784 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL EPCGaN 480 0 R0
SYMATTR InstName U1
SYMATTR Value EPC2214
SYMBOL EPCGaN 480 256 R0
SYMATTR InstName U2
SYMATTR Value EPC2214
SYMBOL LMG1210-simple 48 0 R0
WINDOW 0 -46 -126 Left 2
WINDOW 39 -53 -99 Left 2
SYMATTR InstName X2
SYMATTR SpiceLine PropagationDelay=15n
SYMBOL res 960 -144 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10m
SYMBOL cap 656 144 R0
SYMATTR InstName C2
SYMATTR Value 10p
SYMBOL res 656 208 R0
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL res -1312 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rhyst}
SYMBOL Comparators\\LT1715 -1312 176 R0
SYMATTR InstName U4
SYMBOL schottky -1920 384 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage -1936 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value {2.5-EAclamp+0.35}
SYMBOL voltage -3168 592 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 1.58
SYMBOL cap -3408 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL schottky -1920 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage -1840 -80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value {2.5 + EAclamp - 0.35}
SYMBOL res -1760 176 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL voltage 1440 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 5
SYMBOL voltage 1440 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 5
SYMBOL voltage -3504 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value SINE(20V 0.1 600k)
SYMBOL res -2160 176 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100
SYMBOL cap -2432 -64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 10f
SYMBOL OpAmps\\LT1803 -2512 192 R0
SYMATTR InstName U3
SYMBOL cap 1184 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL OpAmps\\LT1803 -2960 -160 R0
SYMATTR InstName U5
SYMBOL res -2656 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1k
TEXT -960 632 Left 2 !.tran 0 230u 30u uic
TEXT -968 656 Left 2 !.lib opamp.sub
TEXT -968 696 Left 2 !.param EAgain=5
TEXT -1448 -88 Left 2 ;gm_comp = 1/rm = 10 A/V
TEXT -1440 -40 Left 2 ;gm_tot = A-fb * gm_comp
TEXT 1112 776 Left 2 ;Iout 1mA (gm*0.1) @ Vsens-max 100mV -> \nR7=1k.  Imax =>1V:  \n \nR1 = Vsens-max / Imax = 0.1V / 10A = 10mOhm
TEXT -3048 856 Left 2 ;Vbias = 2.5 + (2.5 - Vc/2)/(Gain-1) = 1.58
TEXT -968 720 Left 2 !.param EAclamp=1
TEXT -968 512 Left 2 !#.step param EAgain 4 5 0.2
TEXT -968 744 Left 2 !.param Imax=15
TEXT -968 768 Left 2 !.param Rhyst=1MEG
