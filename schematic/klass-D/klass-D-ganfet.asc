Version 4
SHEET 1 2372 1308
WIRE -2912 -416 -2912 -464
WIRE -2640 -400 -2784 -400
WIRE -2704 -352 -2704 -448
WIRE -2784 -336 -2784 -400
WIRE -2736 -336 -2784 -336
WIRE -2640 -320 -2640 -400
WIRE -2640 -320 -2672 -320
WIRE -2560 -320 -2640 -320
WIRE -2496 -320 -2560 -320
WIRE -2368 -320 -2416 -320
WIRE -2240 -320 -2368 -320
WIRE -2032 -320 -2160 -320
WIRE -2912 -304 -2912 -336
WIRE -2736 -304 -2912 -304
WIRE 1360 -304 1344 -304
WIRE -2912 -288 -2912 -304
WIRE 1360 -256 1360 -304
WIRE -2704 -240 -2704 -288
WIRE 336 -240 256 -240
WIRE 336 -224 336 -240
WIRE 1104 -128 560 -128
WIRE 1360 -128 1360 -176
WIRE 1360 -128 1104 -128
WIRE 1440 -128 1360 -128
WIRE 560 -96 560 -128
WIRE 1104 -64 1104 -128
WIRE 256 -32 256 -240
WIRE 256 -32 240 -32
WIRE 384 0 240 0
WIRE 480 0 384 0
WIRE -1408 16 -1520 16
WIRE -1200 16 -1328 16
WIRE 256 32 240 32
WIRE -2368 48 -2368 -320
WIRE 256 48 256 32
WIRE 336 48 336 -144
WIRE 336 48 256 48
WIRE 480 48 336 48
WIRE 560 48 560 32
WIRE 560 48 480 48
WIRE 672 48 560 48
WIRE 688 48 672 48
WIRE 784 48 768 48
WIRE 800 48 784 48
WIRE 896 48 880 48
WIRE 992 48 896 48
WIRE 1104 48 1104 0
WIRE 1104 48 992 48
WIRE 1136 48 1104 48
WIRE 1152 48 1136 48
WIRE 1280 48 1216 48
WIRE 256 64 256 48
WIRE 256 64 240 64
WIRE 992 80 992 48
WIRE -1744 96 -1952 96
WIRE 256 96 256 64
WIRE 256 96 240 96
WIRE -2256 112 -2256 48
WIRE -2224 112 -2256 112
WIRE -1328 112 -1328 96
WIRE -1296 112 -1328 112
WIRE 672 112 672 48
WIRE 752 112 672 112
WIRE 1104 112 1104 48
WIRE -1872 128 -1872 64
WIRE -1840 128 -1840 80
WIRE -1328 128 -1328 112
WIRE -1296 128 -1296 112
WIRE 256 128 256 96
WIRE 256 128 240 128
WIRE -3120 144 -3296 144
WIRE -2256 144 -2256 112
WIRE -2224 144 -2224 112
WIRE -144 144 -624 144
WIRE 416 144 288 144
WIRE 672 144 672 112
WIRE -3248 160 -3248 96
WIRE -3216 160 -3216 112
WIRE -2368 160 -2368 48
WIRE -2304 160 -2368 160
WIRE -2288 160 -2304 160
WIRE -2256 160 -2256 144
WIRE -1952 160 -1952 96
WIRE -1888 160 -1952 160
WIRE -1344 160 -1488 160
WIRE 256 160 256 128
WIRE 256 160 240 160
WIRE 560 160 560 48
WIRE -2304 176 -2304 160
WIRE -2272 176 -2304 176
WIRE -2176 176 -2192 176
WIRE -1792 176 -1808 176
WIRE -1200 176 -1200 16
WIRE -1200 176 -1264 176
WIRE -800 176 -1200 176
WIRE -144 176 -800 176
WIRE -3296 192 -3296 144
WIRE -3264 192 -3296 192
WIRE -2176 192 -2176 176
WIRE -2176 192 -2192 192
WIRE -2032 192 -2032 -320
WIRE -2032 192 -2176 192
WIRE -2016 192 -2032 192
WIRE -1888 192 -2016 192
WIRE -1792 192 -1792 176
WIRE -1744 192 -1744 96
WIRE -1744 192 -1792 192
WIRE -1584 192 -1744 192
WIRE -1520 192 -1520 16
WIRE -1520 192 -1584 192
WIRE -1344 192 -1520 192
WIRE 752 192 752 112
WIRE -3120 208 -3120 144
WIRE -3120 208 -3184 208
WIRE -2752 208 -3120 208
WIRE -2304 208 -2752 208
WIRE -2272 208 -2304 208
WIRE 992 208 992 144
WIRE 1104 208 1104 176
WIRE 1104 208 992 208
WIRE -3520 224 -3840 224
WIRE -3344 224 -3456 224
WIRE -3264 224 -3344 224
WIRE -2304 224 -2304 208
WIRE -2304 224 -2320 224
WIRE -2288 224 -2304 224
WIRE 288 224 288 144
WIRE 288 224 240 224
WIRE 672 224 672 208
WIRE -2256 240 -2256 224
WIRE 992 240 992 208
WIRE -1840 256 -1840 224
WIRE -1328 256 -1328 224
WIRE -624 256 -624 144
WIRE 352 256 240 256
WIRE 480 256 352 256
WIRE -1296 272 -1296 224
WIRE -3216 288 -3216 256
WIRE 272 288 240 288
WIRE -3344 304 -3344 224
WIRE -2256 304 -2256 240
WIRE -1872 304 -1872 224
WIRE -2320 320 -2320 224
WIRE 272 320 272 288
WIRE 272 320 240 320
WIRE -3248 336 -3248 256
WIRE 272 336 272 320
WIRE 416 336 416 224
WIRE 416 336 272 336
WIRE 480 336 480 320
WIRE 480 336 416 336
WIRE 560 336 560 288
WIRE 560 336 480 336
WIRE 672 336 672 304
WIRE 672 336 560 336
WIRE 752 336 752 272
WIRE 752 336 672 336
WIRE 272 352 272 336
WIRE 272 352 240 352
WIRE -624 368 -624 336
WIRE 560 400 560 336
WIRE 1456 400 1456 384
WIRE -3344 432 -3344 384
WIRE 1056 480 1056 432
WIRE 1184 480 1184 432
WIRE 1456 496 1456 480
WIRE 1456 496 1360 496
WIRE 1600 496 1456 496
WIRE 1360 512 1360 496
WIRE 1456 512 1456 496
WIRE -2912 608 -2912 -208
WIRE 1056 608 1056 560
WIRE 1184 608 1184 560
WIRE 1184 608 1056 608
WIRE 1360 608 1360 576
WIRE 1360 608 1184 608
WIRE 1456 608 1456 592
WIRE 1456 608 1360 608
WIRE 1616 608 1456 608
WIRE 784 624 784 48
WIRE 1360 624 1360 608
WIRE 1456 624 1456 608
WIRE 1056 656 1056 608
WIRE 1184 656 1184 608
WIRE 896 688 896 48
WIRE 1360 720 1360 688
WIRE 1456 720 1456 704
WIRE 1456 720 1360 720
WIRE 1600 720 1456 720
WIRE 1456 736 1456 720
WIRE 672 752 672 592
WIRE -2912 768 -2912 688
WIRE 784 768 784 624
WIRE 784 768 720 768
WIRE -2320 784 -2320 400
WIRE 1056 784 1056 736
WIRE 1184 784 1184 736
WIRE 592 800 512 800
WIRE -1488 832 -1488 160
WIRE -160 832 -1488 832
WIRE 512 832 512 800
WIRE 512 832 -160 832
WIRE 896 832 896 688
WIRE 896 832 720 832
WIRE 1456 832 1456 816
WIRE 672 960 672 848
WIRE 512 1008 512 832
WIRE 512 1152 512 1088
FLAG 1184 432 5V
FLAG -1328 96 5V
FLAG -2256 48 5V
FLAG 1136 48 Vo
IOPIN 1136 48 BiDir
FLAG -2912 -464 Vo
FLAG 480 48 Sw
FLAG -2016 192 EA
FLAG -3840 224 Vin
IOPIN -3840 224 BiDir
FLAG -160 832 sens
FLAG 384 0 Tg
FLAG 352 256 Bg
FLAG 784 624 Curr+
FLAG 896 688 Curr-
FLAG 1440 -128 +40V
IOPIN 1440 -128 BiDir
FLAG -1584 192 Vp
FLAG 672 592 Vcc+5V
FLAG -800 176 PWM
FLAG -2560 -320 Vfb
FLAG -2704 -448 5V
FLAG 1184 784 -5V
FLAG 1456 832 -5V
FLAG 1456 384 5V
FLAG 1600 720 Clamp-
FLAG 1600 496 Clamp+
FLAG -3216 112 Clamp+
FLAG -3216 288 Clamp-
FLAG -3248 96 5V
FLAG -3248 336 -5V
FLAG -1840 80 Clamp+
FLAG -1840 256 Clamp-
FLAG -1872 64 5V
FLAG -1872 304 -5V
FLAG -1328 256 -5V
FLAG 672 960 -5V
FLAG -2256 304 -5V
FLAG -2704 -240 -5V
FLAG 1360 -304 Vcc+5V
FLAG -2752 208 vin_clamp
FLAG -2368 48 vin_clamp_neg
FLAG 1056 432 2.5V
FLAG 1056 784 -2.5V
FLAG -2912 768 GND_IN
IOPIN -2912 768 BiDir
FLAG -2320 784 GND_IN
IOPIN -2320 784 BiDir
FLAG -624 368 GND_IN
IOPIN -624 368 BiDir
FLAG -1296 272 GND_IN
IOPIN -1296 272 BiDir
FLAG -3344 432 GND_IN
IOPIN -3344 432 BiDir
FLAG 512 1152 GND_IN
IOPIN 512 1152 BiDir
FLAG 560 400 GND_IN
IOPIN 560 400 BiDir
FLAG 992 240 GND_IN
IOPIN 992 240 BiDir
FLAG 1616 608 GND_IN
IOPIN 1616 608 BiDir
FLAG 1280 48 Vo-ac
IOPIN 1280 48 BiDir
DATAFLAG 544 800 ""
DATAFLAG -3792 224 ""
DATAFLAG 928 48 ""
SYMBOL ind 672 64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 330nH
SYMATTR SpiceLine2 IC=0
SYMBOL cap 976 80 R0
WINDOW 40 24 84 Left 2
SYMATTR InstName C1
SYMATTR Value 470nF
SYMBOL res 896 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -68 36 VTop 2
SYMATTR InstName R1
SYMATTR Value {100mV/Imax}
SYMBOL voltage 1184 464 R0
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL res -2928 -432 R0
SYMATTR InstName R2
SYMATTR Value {1k*(Gain-1)}
SYMBOL res -2256 -304 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value {1k*EAgain}
SYMBOL res -2304 416 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL res -2928 -304 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL current-amp 672 816 M0
SYMATTR InstName X1
SYMBOL res 496 992 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL EPCGaN 480 0 R0
SYMATTR InstName U1
SYMATTR Value EPC2214
SYMBOL EPCGaN 480 256 R0
SYMATTR InstName U2
SYMATTR Value EPC2214
SYMBOL cap 656 144 R0
SYMATTR InstName C2
SYMATTR Value 10p
SYMBOL res 656 208 R0
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL res -1312 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rhyst}
SYMBOL Comparators\\LT1715 -1312 176 R0
SYMATTR InstName U4
SYMBOL voltage -2912 592 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {-20 / (Gain-1)}
SYMBOL cap -3456 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL cap 1216 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL OpAmps\\LT1803 -2704 -320 R0
SYMATTR InstName U5
SYMBOL res -2400 -336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL voltage 1184 640 R0
SYMATTR InstName V13
SYMATTR Value 5V
SYMBOL res -3360 288 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 1440 384 R0
SYMATTR InstName R13
SYMATTR Value {(5-EAClamp)/EAClamp * 1k}
SYMBOL res 1440 496 R0
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 1440 608 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL res 1440 720 R0
SYMATTR InstName R18
SYMATTR Value {(5-EAClamp)/EAClamp * 1k}
SYMBOL cap 1344 512 R0
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL cap 1344 624 R0
SYMATTR InstName C7
SYMATTR Value 1n
SYMBOL AD8036 -1856 176 R0
SYMATTR InstName U7
SYMBOL AD8036 -3232 208 R0
SYMATTR InstName U8
SYMBOL voltage 1360 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL ADA4817 -2240 192 R0
SYMATTR InstName U3
SYMBOL voltage 336 -240 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 5
SYMBOL voltage 416 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL voltage -624 240 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value PULSE(0 5 2n 10n 10n 1000 1000)
SYMBOL schottky 1120 0 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value MBRS360
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 1120 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value MBRS360
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 1056 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 2.5
SYMBOL voltage 1056 640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V14
SYMATTR Value 2.5
SYMBOL res 736 176 R0
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL LMG1210-simple2 48 0 R0
SYMATTR InstName X2
TEXT -960 632 Left 2 !.tran 0 30u 0 0.1n
TEXT -968 656 Left 2 !.lib opamp.sub
TEXT -968 696 Left 2 !.param EAgain=4.2
TEXT -1448 -88 Left 2 ;gm_comp = 1/rm = 10 A/V
TEXT -1440 -40 Left 2 ;gm_tot = A-fb * gm_comp
TEXT 1056 992 Left 2 ;Iout 1mA (gm*0.1) @ Vsens-max 100mV -> \nR7=1k.  Imax =>1V:  \n \nR1 = Vsens-max / Imax = 0.1V / 10A = 10mOhm
TEXT -968 720 Left 2 !.param EAclamp=1
TEXT -968 512 Left 2 !#.step param two_pole_enable list  0 1
TEXT -968 744 Left 2 !.param Imax=20
TEXT -968 768 Left 2 !.param Rhyst=1MEG
TEXT -968 824 Left 2 !.param Gain=15
TEXT -952 576 Left 2 !.IC I(L1)=0
TEXT -2360 -616 Left 2 !.model MySwitch SW(Ron=1m Roff=10Meg Vt=0.5 Vh=0)
TEXT -968 536 Left 2 !#.step param Pole list 50k 300k 1Meg 3Meg
TEXT -968 488 Left 2 !#.step param EAGain list 3 6
